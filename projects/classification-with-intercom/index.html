<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=../../workshops/ rel=prev><link href=../claude-multimodal-llm-playground/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.11"><title>Classification with Intercom - Anthropic on AWS</title><link rel=stylesheet href=../../assets/stylesheets/main.4af4bdda.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Segoe+UI:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Segoe UI";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><meta property=og:type content=website><meta property=og:title content="Classification with Intercom - Anthropic on AWS"><meta property=og:description content=None><meta property=og:image content=./assets/images/social/projects/classification-with-intercom.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><meta property=og:url content=None><meta name=twitter:card content=summary_large_image><meta name=twitter:title content="Classification with Intercom - Anthropic on AWS"><meta name=twitter:description content=None><meta name=twitter:image content=./assets/images/social/projects/classification-with-intercom.png><link href=../../assets/stylesheets/glightbox.min.css rel=stylesheet><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style><script src=../../assets/javascripts/glightbox.min.js></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#classification-with-intercom class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Anthropic on AWS" class="md-header__button md-logo" aria-label="Anthropic on AWS" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Anthropic on AWS </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Classification with Intercom </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=black data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Anthropic on AWS" class="md-nav__button md-logo" aria-label="Anthropic on AWS" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> Anthropic on AWS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class=md-nav__item> <a href=../../cookbooks/ class=md-nav__link> <span class=md-ellipsis> Cookbooks </span> </a> </li> <li class=md-nav__item> <a href=../../workshops/ class=md-nav__link> <span class=md-ellipsis> Workshops </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex> <span class=md-ellipsis> Demos </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=true> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Demos </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Classification with Intercom </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_2> <div class="md-nav__link md-nav__container"> <a href=../claude-multimodal-llm-playground/ class="md-nav__link "> <span class=md-ellipsis> Claude Multimodal LLM Playground </span> </a> <label class="md-nav__link " for=__nav_4_2 id=__nav_4_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_2_label aria-expanded=false> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Claude Multimodal LLM Playground </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../claude-multimodal-llm-playground/anthropic/ class=md-nav__link> <span class=md-ellipsis> Anthropic </span> </a> </li> <li class=md-nav__item> <a href=../claude-multimodal-llm-playground/bedrock/ class=md-nav__link> <span class=md-ellipsis> Bedrock </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../claude-tools-chatbot/ class=md-nav__link> <span class=md-ellipsis> Claude Tools Chatbot </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_4_4> <div class="md-nav__link md-nav__container"> <a href=../complex-schema-tool-use/ class="md-nav__link "> <span class=md-ellipsis> Complex Schema Tool Use </span> </a> <label class="md-nav__link " for=__nav_4_4 id=__nav_4_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_4_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4_4> <span class="md-nav__icon md-icon"></span> Complex Schema Tool Use </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../complex-schema-tool-use/nextjs-typescript-example/ class=md-nav__link> <span class=md-ellipsis> NextJS Typescript Example </span> </a> </li> <li class=md-nav__item> <a href=../complex-schema-tool-use/streamlit-python-example/ class=md-nav__link> <span class=md-ellipsis> Streamlit Python Example </span> </a> </li> <li class=md-nav__item> <a href=../complex-schema-tool-use/streamlit-stepfunction-example/ class=md-nav__link> <span class=md-ellipsis> Streamlit Stepfunction Example </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../metaprompt-generator/ class=md-nav__link> <span class=md-ellipsis> Metaprompt Generator </span> </a> </li> <li class=md-nav__item> <a href=../pdf-knowledge-base-with-citations.md class=md-nav__link> <span class=md-ellipsis> PDF Knowledge Base with Citations </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=classification-with-intercom>Classification with Intercom</h1> <h1 id=intercom-ticket-classification-with-claude>Intercom Ticket Classification with Claude</h1> <p>In this demo, we will see how we can integrate Intercom with Amazon Bedrock to provide ticket classification using the Anthropic Claude model. Using Webhooks from Intercom, when a new ticket is created an AWS Lambda function will be invoked that will use Amazon Bedrock to classify the ticket. The same Lambda function will then make an API request to Intercom to update the ticket with the new ticket assignment.</p> <h2 id=overview>Overview</h2> <p><a class=glightbox href=images/IntercomIntegration.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=Overview src=images/IntercomIntegration.png></a></p> <ol> <li>Ticket is created from the client</li> <li>Webhook notification is sent to Amazon API Gateway with ticket information</li> <li>Amazon API Gateway invokes AWS Lambda function</li> <li>Request is made to Amazon Bedrock</li> <li>Response is returned to AWS Lambda function</li> <li>API Request is made to Intercom to update ticket</li> </ol> <h2 id=set-up>Set up</h2> <p>In order to use this demo, you'll need to set up your Intercom application for use with WebHooks. This is a high level overview of the process.</p> <ol> <li>Create a <a href=https://developers.intercom.com/docs/build-an-integration/getting-started>development workspace</a> in Intercom</li> <li>Access the <a href=https://app.intercom.com/a/apps/_/developer-hub>developer hub</a></li> <li>Create a new app</li> <li>Copy the access token from Authentication</li> <li>Create <code>.env</code> file and configure with <code>INTERCOM_API_TOKEN=</code> and the access token to the <code>.env</code> file</li> <li>Deploy the CDK</li> <li>Copy the <code>APIGatewayURL</code> from the CDK output</li> <li>Add the APIGatewayURL to the Webhook in Intercom</li> <li>Add relevant topics</li> <li>Create teams</li> <li>Copy App ID</li> <li>Create <code>intercom-client/.env</code> and configure with <code>VITE_INTERCOM_APP_ID=</code> App ID</li> <li>Start local client</li> </ol> <h3 id=intercom-configuration>Intercom Configuration</h3> <p>To use this demo, you'll need to configure Intercom to send notification to the Amazon API Gateway. To do this, you will need to create an App in Intercom. This will be done through the <a href=https://app.intercom.com/a/apps/_/developer-hub>developer hub</a>. Once you have created the App, copy the access token generated. This will be used by the AWS Lambda function when making requests. We will update this using AWS Secrets Manager during the deployment.</p> <p><a class=glightbox href=images/AccessToken.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=AccessToken src=images/AccessToken.png></a></p> <h3 id=cdk-deployment>CDK Deployment</h3> <p>This demo will deploy several resources within your AWS account. In order to deploy this CDK, you should have the following:</p> <ul> <li><a href=https://yarnpkg.com/getting-started/install>Yarn</a> installed</li> <li>AWS CLI <a href=https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html>installed</a> and <a href=https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html>configured</a></li> <li><a href=https://docs.aws.amazon.com/bedrock/latest/userguide/model-access.html>Claude Haiku access</a> in Bedrock</li> </ul> <p>To deploy:</p> <p>Create a <code>.env</code> file and add your access token.</p> <pre><code>INTERCOM_API_TOKEN=&quot;xxxxxxxxxxx&quot;
</code></pre> <p>Then, launch the CDK.</p> <pre><code>yarn launch
</code></pre> <p>Once deployed, take note of the <code>IntercomIntegration.APIGatewayURL</code>. This will be used to configure the Webhooks within Intercom.</p> <h3 id=back-to-intercom>Back to Intercom</h3> <h4 id=webhook-configuration>Webhook Configuration</h4> <p>In your app, add the URL to the Webhooks section. When configured with Topics, notifications will be sent to this target and consumed by our AWS Lambda function for processing.</p> <p><a class=glightbox href=images/WebhookTarget.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=Webhook src=images/WebhookTarget.png></a></p> <p>Add the <code>ticket.created</code> topic to this Webhook. Other topics can be added for additional processing.</p> <p>To secure the Amazon API Gateway, we will restrict access to the API Gateway to only the <a href=https://developers.intercom.com/docs/webhooks#which-ip-addresses-should-i-add-to-my-allowlist-for-intercom-webhooks>Intercom IP addresses</a> in the CDK deployment.</p> <pre><code class=language-typescript>      policy: new PolicyDocument({
        statements: [
          new PolicyStatement({
            principals: [new AnyPrincipal()],
            actions: ['execute-api:Invoke'],
            resources: ['execute-api:/*/*/*'],
            effect: Effect.ALLOW,
          }),
          new PolicyStatement({
            principals: [new AnyPrincipal()],
            actions: ['execute-api:Invoke'],
            resources: ['execute-api:/*/*/*'],
            conditions: {
              NotIpAddress: {
                'aws:SourceIp': [
                  '34.231.68.152/32',
                  '34.197.76.213/32',
                  '35.171.78.91/32',
                  '35.169.138.21/32',
                  '52.70.27.159/32',
                  '52.44.63.161/32',
                ],
              },
            },
            effect: Effect.DENY,
          }),
        ],
      }),
</code></pre> <h4 id=add-teams>Add Teams</h4> <p>Add <a href=https://app.intercom.com/a/apps/_/settings/helpdesk/teams>several teams</a> to your Intercom account. These are the potential teams that a ticket will be routed to. In this example, we are using the following teams to simulate an insurance company:</p> <pre><code>Account
Billing
Claims
Policy
Sales
Support
Technical
</code></pre> <p><a class=glightbox href=images/IntercomTeams.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=Teams src=images/IntercomTeams.png></a></p> <h4 id=workspace-app>Workspace App</h4> <p>In the <a href=https://app.intercom.com/a/apps/_/settings/workspace/general>General</a> section of your workspace, copy the App ID that is being used.</p> <p><a class=glightbox href=images/AppID.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=AppID src=images/AppID.png></a></p> <h3 id=client-configuration>Client Configuration</h3> <p>With this App ID, we will finally configure the client to use this App ID.</p> <p>Create and configure the <code>./intercom-client/.env</code> file with this App ID:</p> <pre><code>VITE_INTERCOM_APP_ID='xxxxxx'
</code></pre> <h3 id=launch-client>Launch Client</h3> <pre><code>cd intercom-client
yarn dev
</code></pre> <h2 id=integration-in-action>Integration in Action</h2> <p>Once everything is deployed and configured, we can see the integration in action. After starting the client, navigate to <code>http://localhost:5173/</code></p> <p><a class=glightbox href=images/Client.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=Client src=images/Client.png></a></p> <p>You should see the Intercom chat widget in the lower right corner.</p> <p><a class=glightbox href=images/Widget.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=Widget src=images/Widget.png></a></p> <p>Open that widget so we can create a Support Request.</p> <p><a class=glightbox href=images/SupportRequest.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt="Support Request" src=images/SupportRequest.png></a></p> <p>Enter a Title and Description for the request.</p> <p>For example:</p> <pre><code>Title: Accident
Description: I was just in an accident and don't know what to do. Please help.
</code></pre> <p>When this request is submitted, it will initially be <code>Unassigned</code>. However, we want to automatically assign this ticket to the correct team. After processing with Amazon Bedrock, this ticket will be assigned to the Claims team.</p> <p><a class=glightbox href=images/AssignTicket.png data-type=image data-width=auto data-height=auto data-desc-position=bottom><img alt=AssignedTicket src=images/AssignTicket.png></a></p> <h2 id=how-it-works>How it works</h2> <p>In order to assign this ticket, we will be passing the request information from Intercom to our Lambda function. This is done through Webhooks from Intercom.</p> <p>The notification will look something like this:</p> <pre><code class=language-json>{
  &quot;type&quot;: &quot;notification_event&quot;,
  &quot;app_id&quot;: &quot;xxxxxx&quot;,
  &quot;data&quot;: {
    &quot;type&quot;: &quot;notification_event_data&quot;,
    &quot;item&quot;: {
      &quot;type&quot;: &quot;ticket&quot;,
      &quot;id&quot;: &quot;25&quot;,
      &quot;ticket_id&quot;: &quot;21&quot;,
      &quot;ticket_attributes&quot;: {
        &quot;_default_title_&quot;: &quot;Accident&quot;,
        &quot;_default_description_&quot;: &quot;I was just in an accident and don't know what to do.  Please help.  &quot;,
        &quot;Platforms&quot;: null,
        &quot;Root cause&quot;: null
      }
    }
  }
}
</code></pre> <p>In order to route this to the correct team, we need to know what teams and admins are available. We will query Intercom for this information and use it when we're updating the ticket.</p> <pre><code class=language-typescript>const response = await fetch('https://api.intercom.io/teams', {
  method: 'GET',
  headers: {
    'Intercom-Version': '2.11',
    'Authorization': `Bearer ${intercomToken}`,
  },
});

const response = await fetch('https://api.intercom.io/admins', {
  method: 'GET',
  headers: {
    'Intercom-Version': '2.11',
    'Authorization': `Bearer ${intercomToken}`,
  },
});
</code></pre> <h3 id=classify>Classify</h3> <p>To classify the ticket correctly, we will create a <a href=https://docs.anthropic.com/en/docs/build-with-claude/prompt-engineering/multishot-prompting#example-analyzing-customer-feedback>multi-shot example prompt</a> to help Claude route it to the correct team using labeled categories.</p> <pre><code class=language-typescript>const categories = `&lt;category&gt; 
    &lt;label&gt;Billing Inquiries&lt;/label&gt;
    &lt;content&gt; Questions about invoices, charges, fees, and premiums Requests for clarification on billing statements Inquiries about payment methods and due dates 
    &lt;/content&gt; 
&lt;/category&gt; 
&lt;category&gt; 
    &lt;label&gt;Policy Administration&lt;/label&gt;
    &lt;content&gt; Requests for policy changes, updates, or cancellations Questions about policy renewals and reinstatements Inquiries about adding or removing coverage options 
    &lt;/content&gt; 
&lt;/category&gt; 
&lt;category&gt; 
    &lt;label&gt;Claims Assistance&lt;/label&gt; 
    &lt;content&gt; Questions about the claims process and filing procedures Requests for help with submitting claim documentation Inquiries about claim status and payout timelines 
    &lt;/content&gt; 
&lt;/category&gt; 
&lt;category&gt; 
    &lt;label&gt;Coverage Explanations&lt;/label&gt; 
    &lt;content&gt; Questions about what is covered under specific policy types Requests for clarification on coverage limits and exclusions Inquiries about deductibles and out-of-pocket expenses 
    &lt;/content&gt; 
&lt;/category&gt; 
&lt;category&gt; 
    &lt;label&gt;Quotes and Proposals&lt;/label&gt; 
    &lt;content&gt; Requests for new policy quotes and price comparisons Questions about available discounts and bundling options Inquiries about switching from another insurer 
    &lt;/content&gt; 
&lt;/category&gt; 
&lt;category&gt; 
    &lt;label&gt;Account Management&lt;/label&gt; 
    &lt;content&gt; Requests for login credentials or password resets Questions about online account features and functionality Inquiries about updating contact or personal information 
    &lt;/content&gt; 
&lt;/category&gt; 
&lt;category&gt; 
    &lt;label&gt;Billing Disputes&lt;/label&gt; 
    &lt;content&gt; Complaints about unexpected or incorrect charges Requests for refunds or premium adjustments Inquiries about late fees or collection notices 
    &lt;/content&gt; 
&lt;/category&gt; 
&lt;category&gt; 
    &lt;label&gt;Claims Disputes&lt;/label&gt; 
    &lt;content&gt; Complaints about denied or underpaid claims Requests for reconsideration of claim decisions Inquiries about appealing a claim outcome 
    &lt;/content&gt; 
&lt;/category&gt; 
&lt;category&gt; 
    &lt;label&gt;Policy Comparisons&lt;/label&gt; 
    &lt;content&gt; Questions about the differences between policy options Requests for help deciding between coverage levels Inquiries about how policies compare to competitors' offerings 
    &lt;/content&gt; 
&lt;/category&gt; 
&lt;category&gt; 
    &lt;label&gt;General Inquiries&lt;/label&gt; 
    &lt;content&gt; Questions about company contact information or hours of operation Requests for general information about products or services Inquiries that don't fit neatly into other categories 
    &lt;/content&gt; 
&lt;/category&gt;`;

export async function classifyTicket(ticketContent: string): Promise&lt;string&gt; {
  const prompt = `
    You will classify a customer support ticket into one of the following categories:
    &lt;categories&gt;
        ${categories}
    &lt;/categories&gt;

    Here is the customer support ticket:
    &lt;ticket&gt;
        ${ticketContent}
    &lt;/ticket&gt;

    Respond with just the label of the category between category tags.
  `;

  return invokeBedrock(prompt);
}

export async function invokeBedrock(prompt: string): Promise&lt;string&gt; {
  const params = {
    modelId: BEDROCK_MODEL_ID,
    contentType: 'application/json',
    accept: 'application/json',
    body: JSON.stringify({
      anthropic_version: 'bedrock-2023-05-31',
      max_tokens: 4096,
      messages: [
        { role: 'user', content: prompt },
        { role: 'assistant', content: '&lt;category&gt;' },
      ],
      temperature: 0,
      top_p: 1,
      stop_sequences: ['&lt;/category&gt;'],
    }),
  };

  try {
    const command = new InvokeModelCommand(params);
    const response = await bedrockClient.send(command);

    const responseBody = JSON.parse(new TextDecoder().decode(response.body));
    return responseBody.content[0].text.trim();
  } catch (error) {
    console.error('Error invoking Bedrock:', error);
    throw error;
  }
}
</code></pre> <p>When this prompt passed to Bedrock, Claude Haiku will be used to classify the ticket using one of the available teams. This classification could be further enhanced with RAG to provide even more context to Claude. In this simple example, we will use just these examples.</p> <p>Once classified, an API request is made to Intercom to update the ticket with the new assignee.</p> <pre><code class=language-typescript>const response = await fetch(`https://api.intercom.io/tickets/${ticketId}`, {
  method: 'PUT',
  headers: {
    'Content-Type': 'application/json',
    'Accept': 'application/json',
    'Intercom-Version': '2.11',
    'Authorization': `Bearer ${intercomToken}`,
  },
  body: JSON.stringify({
    assignment: {
      admin_id: selectedAdmin.id,
      assignee_id: assigneeId,
    },
    state: 'in_progress',
  }),
});
</code></pre> <h2 id=clean-up>Clean up</h2> <p>To remove the AWS resources deployed as part of this demo:</p> <pre><code>yarn cdk destroy
</code></pre> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["header.autohide", "navigation.instant", "navigation.sections", "navigation.top", "navigation.indexes", "search.highlight", "search.share", "search.suggest", "content.code.annotate", "content.tooltips", "content.tabs.link", "content.code.copy"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.c8b220af.min.js></script> <script id=init-glightbox>const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body> </html>